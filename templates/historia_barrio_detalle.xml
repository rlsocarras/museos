<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="historia_barrio_detalle" name="Historia de Barrio - Detalle">
            <t t-call="website.layout">
                <t t-set="title" t-value="historia.name"/>
                
                <!-- Estilos CSS específicos -->
                <style>
                    

/* Oculta header y footer de Odoo */
    header#top,
    footer.o_footer,
    .o_main_navbar,
    .o_main_navbar ~ div,
    #oe_main_menu_navbar,
    .navbar,
    .o_website_chatter_container,
    .o_footer_copyright {
        display: none !important;
    }
    
    /* Ajusta el contenido para que ocupe toda la pantalla */
    .historia-detalle-page {
        margin-top: -80px !important;
        min-height: 100vh !important;
    }
    
    /* Asegura que el contenido no quede escondido */
    #wrap {
        margin-top: 0 !important;
        padding-top: 0 !important;
    }


                    /* Estilos para la página de historia */
                    .historia-detalle-page {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        min-height: 100vh;
                    }
                    
                    .historia-wrapper {
                        background: white;
                        border-radius: 30px 30px 0 0;
                        min-height: 100vh;
                        position: relative;
                        top: 80px;
                        padding-top: 40px;
                    }
                    
                    /* Breadcrumb moderno */
                    .breadcrumb-modern {
                        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
                        border-radius: 25px;
                        padding: 15px 25px;
                        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                    }
                    
                    .breadcrumb-modern .breadcrumb-item a {
                        color: white;
                        text-decoration: none;
                        font-weight: 500;
                    }
                    
                    .breadcrumb-modern .breadcrumb-item.active {
                        color: rgba(255,255,255,0.9);
                    }
                    
                    .breadcrumb-modern .breadcrumb-item + .breadcrumb-item::before {
                        color: rgba(255,255,255,0.7);
                        content: "›";
                    }
                    
                    /* Hero Section mejorada */
                    .historia-hero {
                        background: linear-gradient(rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
                        border-radius: 25px;
                        padding: 40px;
                        margin: 30px 0;
                        backdrop-filter: blur(10px);
                        border: 1px solid rgba(255,255,255,0.2);
                    }
                    
                    .historia-category {
                        background: linear-gradient(90deg, #3498db, #2ecc71);
                        color: white;
                        padding: 8px 20px;
                        border-radius: 50px;
                        font-weight: 600;
                        display: inline-flex;
                        align-items: center;
                        gap: 10px;
                        margin-bottom: 20px;
                        box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
                    }
                    
                    .historia-title {
                        font-size: 2.8rem;
                        font-weight: 800;
                        background: linear-gradient(90deg, #2c3e50, #3498db);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        margin: 20px 0;
                        line-height: 1.2;
                    }
                    
                    .historia-meta-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                        gap: 20px;
                        margin-top: 30px;
                    }
                    
                    .meta-card {
                        background: white;
                        padding: 20px;
                        border-radius: 15px;
                        box-shadow: 0 5px 20px rgba(0,0,0,0.08);
                        display: flex;
                        align-items: center;
                        gap: 15px;
                        transition: transform 0.3s ease;
                    }
                    
                    .meta-card:hover {
                        transform: translateY(-5px);
                    }
                    
                    .meta-icon {
                        width: 50px;
                        height: 50px;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        border-radius: 12px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        font-size: 1.5rem;
                    }
                    
                    /* Status Box mejorado */
                    .historia-status-box {
                        background: white;
                        border-radius: 20px;
                        padding: 25px;
                        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                        border: 2px solid #f8f9fa;
                    }
                    
                    .status-badge {
                        background: linear-gradient(90deg, #ff6b6b, #ee5a24);
                        color: white;
                        padding: 10px 25px;
                        border-radius: 25px;
                        font-weight: 600;
                        text-align: center;
                        margin: 15px 0;
                        display: inline-block;
                        box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
                    }
                    
                    /* Contenido principal */
                    .historia-content {
                        background: white;
                        border-radius: 25px;
                        padding: 40px;
                        box-shadow: 0 10px 40px rgba(0,0,0,0.08);
                        margin: 30px 0;
                    }
                    
                    /* Testimonios elegantes */
                    .testimonios-section {
                        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                        border-radius: 20px;
                        padding: 30px;
                        margin-top: 40px;
                    }
                    
                    .testimonio-item {
                        background: white;
                        padding: 25px;
                        border-radius: 15px;
                        margin: 15px 0;
                        position: relative;
                        border-left: 5px solid #3498db;
                        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
                    }
                    
                    .testimonio-item i {
                        color: #3498db;
                        font-size: 2rem;
                        margin-right: 15px;
                        opacity: 0.3;
                        position: absolute;
                        top: 15px;
                        left: 15px;
                    }
                    
                    /* Documentación */
                    .documentacion-section {
                        background: linear-gradient(135deg, #fff8e1 0%, #fff3e0 100%);
                        border-radius: 20px;
                        padding: 30px;
                        border: 2px dashed #ffb74d;
                    }
                    
                    .btn-download-elegant {
                        background: linear-gradient(90deg, #3498db, #2ecc71);
                        color: white;
                        padding: 12px 30px;
                        border-radius: 25px;
                        text-decoration: none;
                        display: inline-flex;
                        align-items: center;
                        gap: 10px;
                        font-weight: 600;
                        transition: all 0.3s ease;
                        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
                    }
                    
                    .btn-download-elegant:hover {
                        transform: translateY(-3px);
                        box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
                        color: white;
                    }
                    
                    /* Sidebar moderna */
                    .historia-sidebar {
                        position: sticky;
                        top: 100px;
                    }
                    
                    .sidebar-card-elegant {
                        background: white;
                        border-radius: 20px;
                        padding: 25px;
                        margin-bottom: 25px;
                        box-shadow: 0 8px 25px rgba(0,0,0,0.08);
                        border: 1px solid #f8f9fa;
                        transition: transform 0.3s ease;
                    }
                    
                    .sidebar-card-elegant:hover {
                        transform: translateY(-5px);
                    }
                    
                    .sidebar-title-elegant {
                        color: #2c3e50;
                        font-size: 1.2rem;
                        font-weight: 700;
                        margin-bottom: 20px;
                        display: flex;
                        align-items: center;
                        gap: 10px;
                    }
                    
                    .museo-card-elegant {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                    }
                    
                    .museo-card-elegant .sidebar-title-elegant {
                        color: white;
                    }
                    
                    .museo-avatar {
                        width: 60px;
                        height: 60px;
                        border-radius: 15px;
                        overflow: hidden;
                        border: 3px solid white;
                        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                    }
                    
                    /* Botones sociales */
                    .social-sharing-elegant {
                        display: flex;
                        gap: 10px;
                        justify-content: center;
                    }
                    
                    .btn-social-elegant {
                        width: 45px;
                        height: 45px;
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        text-decoration: none;
                        transition: all 0.3s ease;
                        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
                    }
                    
                    .btn-social-facebook {
                        background: linear-gradient(135deg, #1877f2, #0d5fcc);
                    }
                    
                    .btn-social-twitter {
                        background: linear-gradient(135deg, #1da1f2, #0c8bd9);
                    }
                    
                    .btn-social-whatsapp {
                        background: linear-gradient(135deg, #25d366, #1da851);
                    }
                    
                    .btn-social-copiar {
                        background: linear-gradient(135deg, #6c757d, #495057);
                    }
                    
                    .btn-social-elegant:hover {
                        transform: translateY(-3px) scale(1.1);
                        box-shadow: 0 6px 20px rgba(0,0,0,0.2);
                    }
                    
                    /* Lista de historias */
                    .historia-list-item {
                        background: white;
                        border-radius: 12px;
                        padding: 15px;
                        margin-bottom: 10px;
                        border-left: 4px solid #3498db;
                        transition: all 0.3s ease;
                    }
                    
                    .historia-list-item:hover {
                        background: #f8f9fa;
                        transform: translateX(5px);
                        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                    }
                    
                    /* Responsive */
                    @media (max-width: 768px) {
                        .historia-wrapper {
                            top: 60px;
                            border-radius: 20px 20px 0 0;
                        }
                        
                        .historia-title {
                            font-size: 2rem;
                        }
                        
                        .historia-meta-grid {
                            grid-template-columns: 1fr;
                        }
                        
                        .historia-sidebar {
                            position: static;
                            margin-top: 30px;
                        }
                    }
                </style>
                
                <div id="wrap" class="historia-detalle-page">
                    <div class="historia-wrapper">
                        <div class="container">
                            <!-- Breadcrumb moderno -->
                            <nav aria-label="breadcrumb" class="my-4">
                                <ol class="breadcrumb breadcrumb-modern">
                                    <li class="breadcrumb-item">
                                        <a href="/">
                                            <i class="bi bi-house-door"></i> Inicio
                                        </a>
                                    </li>
                                    <li class="breadcrumb-item">
                                        <a t-attf-href="/museos/#{museo.id}">
                                            <i class="bi bi-building"></i>
                                            <t t-esc="museo.name"/>
                                        </a>
                                    </li>
                                    <li class="breadcrumb-item">
                                        <a href="#historia">
                                            <i class="bi bi-book"></i> Historias
                                        </a>
                                    </li>
                                    <li class="breadcrumb-item active" aria-current="page">
                                        <i class="bi bi-geo-alt"></i>
                                        <t t-esc="historia.name[:20]"/>
                                        <t t-if="len(historia.name) > 20">...</t>
                                    </li>
                                </ol>
                            </nav>
                            
                            <!-- Hero Section mejorada -->
                            <div class="historia-hero">
                                <div class="row align-items-center">
                                    <div class="col-lg-8">
                                        <div class="historia-header">
                                            <span class="historia-category">
                                                <t t-if="historia.fuente == 'oral'">
                                                    <i class="bi bi-mic-fill"></i> Tradición Oral
                                                </t>
                                                <t t-elif="historia.fuente == 'documental'">
                                                    <i class="bi bi-archive-fill"></i> Fuente Documental
                                                </t>
                                                <t t-elif="historia.fuente == 'arqueologica'">
                                                    <i class="bi bi-shovel-fill"></i> Evidencia Arqueológica
                                                </t>
                                                <t t-else="">
                                                    <i class="bi bi-collection-fill"></i> Fuente Mixta
                                                </t>
                                            </span>
                                            <h1 class="historia-title">
                                                <t t-esc="historia.name"/>
                                            </h1>
                                            
                                            <div class="historia-meta-grid">
                                                <div class="meta-card">
                                                    <div class="meta-icon">
                                                        <i class="bi bi-geo-alt-fill"></i>
                                                    </div>
                                                    <div>
                                                        <h6 class="mb-1 text-muted">Barrio</h6>
                                                        <p class="mb-0 fw-bold fs-5">
                                                            <t t-esc="historia.barrio"/>
                                                            <t t-if="historia.ciudad">, <t t-esc="historia.ciudad"/></t>
                                                        </p>
                                                    </div>
                                                </div>
                                                
                                                <div class="meta-card">
                                                    <div class="meta-icon">
                                                        <i class="bi bi-calendar-event-fill"></i>
                                                    </div>
                                                    <div>
                                                        <h6 class="mb-1 text-muted">Registrado</h6>
                                                        <p class="mb-0 fw-bold fs-5">
                                                            <t t-esc="historia.fecha_registro.strftime('%d de %B de %Y')"/>
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <div class="historia-status-box">
                                            <h5 class="text-center mb-4">
                                                <i class="bi bi-clipboard-data"></i>
                                                Estado de investigación
                                            </h5>
                                            <div class="text-center">
                                                <div class="status-badge">
                                                    <t t-esc="dict(historia._fields['estado_investigacion'].selection).get(historia.estado_investigacion, '')"/>
                                                </div>
                                            </div>
                                            <div class="text-center mt-4 pt-3 border-top">
                                                <h6 class="mb-3">
                                                    <i class="bi bi-person-badge"></i>
                                                    Investigador responsable
                                                </h6>
                                                <p class="mb-0 fs-5 fw-bold text-primary">
                                                    <i class="bi bi-person-circle"></i>
                                                    <t t-esc="historia.investigador_responsable"/>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Contenido Principal -->
                            <div class="row">
                                <div class="col-lg-8">
                                    <article class="historia-content">
                                        <div class="historia-body" t-field="historia.contenido_historico" t-options='{"widget": "html"}'/>
                                        
                                        <!-- Testimonios -->
                                        <t t-if="historia.testimonios and len(historia.testimonios.strip()) > 0">
                                            <div class="testimonios-section">
                                                <h3 class="section-title mb-4">
                                                    <i class="bi bi-chat-quote-fill"></i>
                                                    Testimonios Recopilados
                                                </h3>
                                                <p class="text-muted mb-4">Voces que preservan la memoria del barrio</p>
                                                <div class="testimonios-content">
                                                    <t t-foreach="historia.testimonios.split('\n')" t-as="testimonio">
                                                        <t t-if="testimonio.strip()">
                                                            <div class="testimonio-item">
                                                                <i class="bi bi-quote"></i>
                                                                <p class="fs-5">
                                                                    <t t-esc="testimonio.strip()"/>
                                                                </p>
                                                            </div>
                                                        </t>
                                                    </t>
                                                </div>
                                            </div>
                                        </t>
                                    </article>
                                    
                                    <!-- Documentación adjunta -->
                                    <t t-if="historia.documentacion">
                                        <div class="documentacion-section">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h3 class="mb-2">
                                                        <i class="bi bi-paperclip"></i>
                                                        Documentación disponible
                                                    </h3>
                                                    <p class="text-muted mb-0">
                                                        Archivo: <strong><t t-esc="historia.documentacion_filename"/></strong>
                                                    </p>
                                                </div>
                                                <a t-attf-href="/web/content/#{historia._model}/#{historia.id}/documentacion" 
                                                   class="btn-download-elegant" 
                                                   download="">
                                                    <i class="bi bi-cloud-download"></i>
                                                    Descargar
                                                </a>
                                            </div>
                                        </div>
                                    </t>
                                </div>
                                
                                <!-- Sidebar -->
                                <div class="col-lg-4">
                                    <div class="historia-sidebar">
                                        <!-- Museo relacionado -->
                                        <div class="sidebar-card-elegant museo-card-elegant">
                                            <h5 class="sidebar-title-elegant">
                                                <i class="bi bi-building"></i>
                                                Museo relacionado
                                            </h5>
                                            <div class="museo-info text-center">
                                                <div class="museo-avatar mx-auto mb-3">
                                                    <img t-att-src="'/web/image/museo.museo/%s/imagen_principal' % museo.id" 
                                                         alt="Museo" 
                                                         class="img-fluid w-100 h-100 object-fit-cover"/>
                                                </div>
                                                <h4 class="mb-2">
                                                    <a t-attf-href="/museos/#{museo.id}" class="text-white text-decoration-none">
                                                        <t t-esc="museo.name"/>
                                                    </a>
                                                </h4>
                                                <p class="text-white-50 mb-3">
                                                    <i class="bi bi-geo-alt"></i>
                                                    <t t-esc="museo.direccion[:80]"/>...
                                                </p>
                                                <a t-attf-href="/museos/#{museo.id}" class="btn btn-light btn-sm w-100">
                                                    <i class="bi bi-arrow-left-circle"></i>
                                                    Volver al museo
                                                </a>
                                            </div>
                                        </div>
                                        
                                        <!-- Otras historias -->
                                        <t t-set="otras_historias" t-value="request.env['museo.historia.barrio'].search([
                                            ('museo_id', '=', museo.id),
                                            ('id', '!=', historia.id),
                                            ('active', '=', True)
                                        ], limit=5, order='fecha_registro desc')"/>
                                        
                                        <t t-if="otras_historias">
                                            <div class="sidebar-card-elegant">
                                                <h5 class="sidebar-title-elegant">
                                                    <i class="bi bi-clock-history"></i>
                                                    Más historias
                                                </h5>
                                                <div>
                                                    <t t-foreach="otras_historias" t-as="otra">
                                                        <a t-attf-href="/historia/barrio/#{otra.id}" 
                                                           class="historia-list-item d-block text-decoration-none">
                                                            <div class="d-flex justify-content-between align-items-start">
                                                                <div>
                                                                    <h6 class="mb-1 text-dark">
                                                                        <t t-esc="otra.name"/>
                                                                    </h6>
                                                                    <small class="text-muted">
                                                                        <i class="bi bi-geo-alt"></i>
                                                                        <t t-esc="otra.barrio"/>
                                                                    </small>
                                                                </div>
                                                                <small class="text-nowrap text-muted">
                                                                    <t t-esc="otra.fecha_registro.strftime('%d/%m/%y')"/>
                                                                </small>
                                                            </div>
                                                        </a>
                                                    </t>
                                                </div>
                                            </div>
                                        </t>
                                        
                                        <!-- Compartir -->
                                        <div class="sidebar-card-elegant">
                                            <h5 class="sidebar-title-elegant">
                                                <i class="bi bi-share-fill"></i>
                                                Compartir esta historia
                                            </h5>
                                            <div class="social-sharing-elegant">
                                                <a href="#" class="btn-social-elegant btn-social-facebook">
                                                    <i class="bi bi-facebook"></i>
                                                </a>
                                                <a href="#" class="btn-social-elegant btn-social-twitter">
                                                    <i class="bi bi-twitter"></i>
                                                </a>
                                                <a href="#" class="btn-social-elegant btn-social-whatsapp">
                                                    <i class="bi bi-whatsapp"></i>
                                                </a>
                                                <button class="btn-social-elegant btn-social-copiar"
                                                        onclick="navigator.clipboard.writeText(window.location.href); alert('Enlace copiado!')">
                                                    <i class="bi bi-link-45deg"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
        </template>
    </data>
</odoo>